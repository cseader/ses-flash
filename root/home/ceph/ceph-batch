#!/bin/bash
#
# ceph-batch
# 
# author cs@suse.com
#
####################

# Global variables
nodes="node1 node2 node3"

# Arrays
anodes=($nodes)
osd=(vdb vdc)

# Function discovering OSD's (availabled disks not /)
#discover_osd ()
# rootdisk=`mount | grep "on \/ " | awk {'print $1'} | sed 's/.....//;s/.$//g'`
# alldisks=`parted -l | grep "Disk \/" | awk {'print $2'} | sed 's/.....//;s/.$//g' | xargs`
# osd=$(echo "$alldisks" | sed 's/'$rootdisk'//g')

# ceph-deploy install
ceph-deploy install $nodes

# ceph-deploy new
ceph-deploy new $nodes

# ceph-deploy mon create-initial
# Create the initial monitor service on already created monitor nodes
ceph-deploy mon create-initial

# clean disks
for i in "${osd[@]}"; do
  for n in "${anodes[@]}"; do
    ceph-deploy disk zap "$n":"$i"
  done
done

# prepare disks
for i in "${osd[@]}"; do
  for n in "${anodes[@]}"; do
    ceph-deploy --overwrite-conf osd prepare "$n":"$i"
  done
done 

# activate disks
for i in "${osd[@]}"; do
  for n in "${anodes[@]}"; do
    ceph-deploy osd activate "$n":"$i"1
  done
done 

